# SOAR-0014: Support Type Substitutions

Allow using user-defined types instead of generated ones, utilizing vendor-extensions

## Overview

- Proposal: SOAR-0014
- Author(s): [simonbility](https://github.com/simonbility)
- Status: **Awaiting Review**
- Issue: [apple/swift-openapi-generator#375](https://github.com/apple/swift-openapi-generator/issues/375)
- Implementation:
    - [apple/swift-openapi-generator#764](https://github.com/apple/swift-openapi-generator/pull/764)
- Affected components:
    - generator

### Introduction

The goal of this proposal is to allow users to specify custom types for generated code using vendor extensions. This will enable users to use their own types instead of the default generated ones, allowing for greater flexibility.

### Motivation

This proposal would enable more flexibility in the generated code.
Some usecases include:
- Using custom types that are already defined in the user's codebase or even coming from a third party library, instead of generating new ones.
- workaround missing support for `format` for strings
- Implement custom validation/encoding/decoding logic that cannot be expressed using the OpenAPI spec

This is intended as a "escape hatch" for use-cases that (currently) cannot be expressed.
Using this comes with the risk of user-provided types not being compliant with the original OpenAPI spec.


### Proposed solution

The proposed solution is to allow the `x-swift-open-api-replace-type` vendor-extension to prevent the generation of types as usual, and instead use the specified type.
This should be supported anywhere within a OpenAPI document where a schema can be defined. (e.g. `components.schemas`, `properites`, `additionalProperties`, etc.)

It can be used in "top-level" schemas, defined in `components.schemas`

```diff
 components:
   schemas:
     UUID:
       type: string
       format: uuid
+      x-swift-open-api-replace-type: Foundation.UUID
```

Will affect the generated code in the following way:
```diff
 /// Types generated from the `#/components/schemas` section of the OpenAPI document.
 enum Schemas {
     /// - Remark: Generated from `#/components/schemas/UUID`.
-    package typealias Uuid = Swift.String
+    package typealias Uuid = Foundation.UUID   
```


This will also work for properties defined inline

```diff
 components:
   schemas:
     UUID:
       type: string
       format: uuid
       
     User:
       type: object
       properties:
         id:
           type: string
         name:
           type: string
+      x-swift-open-api-replace-type: ExternalLibrary.ExternallyDefinedUser
```

Will affect the generated code in the following way:

```diff
enum Schemas {
         /// - Remark: Generated from `#/components/schemas/User`.
-        package struct User: Codable, Hashable, Sendable {
-            /// - Remark: Generated from `#/components/schemas/User/id`.
-            package var id: Components.Schemas.Uuid?
-            /// - Remark: Generated from `#/components/schemas/User/name`.
-            package var name: Swift.String?
-            /// Creates a new `User`.
-            ///
-            /// - Parameters:
-            ///   - id:
-            ///   - name:
-            package init(
-                id: Components.Schemas.Uuid? = nil,
-                name: Swift.String? = nil
-            ) {
-                self.id = id
-                self.name = name
-            }
-            package enum CodingKeys: String, CodingKey {
-                case id
-                case name
-            }
-        }
+        package typealias User = ExternalLibrary.ExternallyDefinedUser
}
```

### Detailed design

The implementation modifies the Translator and the TypeAssignement logic to account for the presence of the vendor extension.

### API stability

While this proposal does affect the generated code, it requires the addition of a very specific vendor-extension.

This is interpreted as a "strong enough" signal of the user to opt into this behaviour, to justify NOT introducing a feauture-flag or considering this a breaking change.


### Future directions

None so far.

### Alternatives considered
An alternative to relying on vendor-extension, was to allow specifying the types to be replaced via paths in the config file like this

```yaml
...
replaceTypes:
    #/components/schemas/User: Foundation.UUID
```

The advantage of this approach is that it could also be used without modifying the OpenAPI document. (which is not always possible/straightforward when using third party API-specs)
